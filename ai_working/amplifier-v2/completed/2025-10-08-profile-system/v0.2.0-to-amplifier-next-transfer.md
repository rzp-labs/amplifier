## Executive take

- **Mostly compatible—at the app layer.** The big v0.2.0 ideas (bring‑to‑project packaging, a “mode”/profile concept, unified config, overlay customization, Git‑distributed resources, CLI‑first UX) align with our kernel philosophy when implemented **outside** the kernel as app‑layer _policy_. v0.2.0-what-and-why
- **Two careful adaptations:** (1) replace v0.2.0’s filesystem/symlink mechanics with _Mount Plan_ generation (no symlinks in core), and (2) treat “modes” as **Profiles** (bundles of modules + config) that resolve into Mount Plans. v0.2.0-what-and-why
- **Skip the Claude‑specific bits** (`.claude/` structure, Claude settings symlinks), and anything that forces policy into the kernel. v0.2.0-what-and-why
- **Observability lines up perfectly** with our hook‑driven JSONL logging plan; keep it all as hook modules and unified JSONL output. Amplifier Logging & Observabili…

---

## Traffic‑light mapping (old → new)

| v0.2.0 concept                                                                          | Keep / Adapt / Skip              | How it fits our kernel model                                                                                                                                                      |
| --------------------------------------------------------------------------------------- | -------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Bring Amplifier to your projects** (installable package, `amplifier init`)            | **Keep**                         | Lives in the **app/CLI**. Kernel receives a resolved Mount Plan; it never reads files or chooses defaults. v0.2.0-what-and-why                                                    |
| **Mode system** (switch dev environments)                                               | **Adapt** → **Profiles**         | Implement **Profiles** as shareable manifests (YAML/TOML) that **compile into Mount Plans** (module set + per‑module config). No symlinks; all policy in app. v0.2.0-what-and-why |
| **Unified configuration** (`.amplifier/config.yaml`) + env overrides                    | **Keep (app)**                   | Keep precedence and env overrides; app resolves to a Mount Plan and passes it to kernel. (Kernel stays policy‑free.) v0.2.0-what-and-why                                          |
| **Overlay customization** (`.amplifier.local/overlay`)                                  | **Adapt** → **Profile Overlays** | Keep three tiers (official / team / user) but implement as **overlayed Profiles** (config merge), not filesystem overlays that the kernel must understand. v0.2.0-what-and-why    |
| **Git‑based resource distribution** (directory fetcher)                                 | **Keep (app)**                   | Keep for **resource packs** (agents, prompts, docs). For code, prefer pip‑installed **modules** (entry points). Kernel doesn’t fetch—app does. v0.2.0-what-and-why                |
| **CLI over make** (Click commands, discoverability)                                     | **Keep**                         | CLI is our policy surface: config precedence, profile apply, resource fetch, logs tail. Kernel offers mechanisms only. v0.2.0-what-and-why                                        |
| **Directory structure reorg** (`.amplifier/…`)                                          | **Adapt**                        | Keep `.amplifier/` as app state; but don’t couple to `.claude/`. Replace symlink steps with “generate Mount Plan + set active profile”. v0.2.0-what-and-why                       |
| **Three‑layer ecosystem** (stable core / official directory / user overlay)             | **Keep (renamed)**               | Maps cleanly: **Kernel** (stable core), **Official modules & profile packs** (curated), **Team & user overlays** (profiles). v0.2.0-what-and-why                                  |
| **Claude‑specific integration** (symlink to `.claude/`, update `.claude/settings.json`) | **Skip**                         | Ties us to the old base; new kernel is provider‑neutral and module‑based. v0.2.0-what-and-why                                                                                     |
| **Transcript & lifecycle hooks**                                                        | **Keep (as hooks)**              | Continue via hook modules; aligns with **hook‑driven logging** + backup (JSONL, unified sink). Amplifier Logging & Observabili…                                                   |
| **Known limitation: env isolation not done**                                            | **Keep the goal**                | Handle via **tool/provider module sandboxes** and/or app‑layer environment management—not in kernel. v0.2.0-what-and-why                                                          |

---

## What to carry forward (and how)

### 1) From **Modes** → **Profiles** (contract‑first bundles)

- **What to keep:** the _bundle_ notion—curated sets of agents/contexts/tools/providers/hooks you can switch atomically. v0.2.0-what-and-why
- **How in the new world:**
  - Define **Profile manifests** (YAML/TOML) that list **module IDs** plus per‑module config and sensible defaults.
  - **App/CLI compiles** a selected Profile (+ overlays) → a **Mount Plan** for the kernel.
  - **No symlinks**; activation = “apply Mount Plan”.
- **Why it fits:** Preservation of policy in app, stable mechanism in kernel; supports team sharing and A/B profiles cleanly.

### 2) **Overlay customization** → **Profile overlays**

- **What to keep:** three‑tier customization (official → team → user) and the “non‑destructive” overlay idea. v0.2.0-what-and-why
- **How in the new world:** Implement **overlayed Profile merges** with precedence (official < team < user). App writes the merged plan; kernel just mounts per the plan.

### 3) **Unified config with env overrides**

- **What to keep:** one config surface; environment overrides like `AMPLIFIER__PATHS__DATA_DIR`. v0.2.0-what-and-why
- **How in the new world:** the **app** performs precedence (default < user < project < `--config` < flags < env) and outputs a Mount Plan. Kernel only validates + mounts.

### 4) **Git‑distributed resources** (non‑code “packs”)

- **What to keep:** versionable, fetchable directories for _content_ (context files, prompts, doc sets) and **shareable Profiles**. v0.2.0-what-and-why
- **How in the new world:**
  - **Modules** (code) continue to come via pip/entry points.
  - **Resource packs / profile packs** come via Git (app fetches) or as pip data packages.
  - Profiles reference module IDs; packs can also include default per‑module config.

### 5) **CLI‑first UX**

- **What to keep:** `amplifier init`, `amplifier profile apply <name>`, `amplifier resources fetch`, `amplifier logs tail`. v0.2.0-what-and-why
- **How in the new world:** The CLI _is_ the policy orchestrator; kernel receives a fully resolved plan.

### 6) **Observability foundations**

- **What to keep:** event coverage, unified JSONL, non‑interference; adopt correlation IDs (`session_id`, `request_id`, `span_id`) and redaction by hook. Amplifier Logging & Observabili…
- **How in the new world:** Use the **hooks‑redaction** then **hooks‑logging** modules we scaffolded; kernel emits lifecycle events; app config turns them on by default. Amplifier Logging & Observabili…

---

## What to **not** carry forward (and why)

- **Symlink mechanics to `.claude/`** and direct edits to `.claude/settings.json`.
  _Why:_ provider‑neutral kernel; filesystem tricks aren’t needed once Profiles compile to Mount Plans. v0.2.0-what-and-why
- **Core that chooses defaults / does file I/O for config.**
  _Why:_ violates mechanism‑not‑policy; app/CLI owns defaults and precedence; kernel stays tiny and stable.

---

## “Term translation” (old → new)

- **Mode** → **Profile** (bundle that compiles to a Mount Plan) v0.2.0-what-and-why
- **Overlay** → **Profile overlay** (precedence merge at app) v0.2.0-what-and-why
- **Directory fetcher** → **Resource/Profile pack fetcher** (app) v0.2.0-what-and-why
- **Claude directory** → **none** (replace with kernel events + modules) v0.2.0-what-and-why

---

## Concrete import plan (short, surgical)

1.  **Profile schema (app)**
    - Manifest fields: `orchestrator`, `context`, `providers`, `tools`, `hooks`, optional `search_paths`, and per‑module config.
    - Implement **overlay merge** (official < team < user) to produce a Mount Plan. v0.2.0-what-and-why
2.  **CLI commands**
    - `amplifier profile list/apply <name>` → resolves overlays → writes the Mount Plan → constructs `AmplifierSession(plan, ModuleLoader(search_paths))`.
    - `amplifier resources fetch` → pulls Git resource/profile packs. v0.2.0-what-and-why
    - `amplifier logs tail` → tails JSONL (provided by hooks), with basic filters. Amplifier Logging & Observabili…
3.  **Config precedence**
    - Keep `.amplifier/config.yaml` (or TOML) + env overrides like `AMPLIFIER__MODELS__DEFAULT`. App resolves → kernel mounts. v0.2.0-what-and-why
4.  **Hook modules on by default**
    - Enable `hooks-redaction` (priority 10) then `hooks-logging` (priority 100). Use schema v1 and event taxonomy we’ve set. Amplifier Logging & Observabili…
5.  **De‑Claude** any legacy content
    - When porting old “modes”, translate them into **Profiles** pointing at current modules; drop `.claude/*` symlink steps. v0.2.0-what-and-why

---

## Risks & mitigations

- **“Modes” expected to manipulate files** → Some users may miss symlink‑visible artifacts.
  **Mitigation:** Add `amplifier profile show` to print the **effective Mount Plan** (human‑readable), and optional “dry‑run” diffs to show what would change on apply. v0.2.0-what-and-why
- **Resource versioning** for directory items was weak in v0.2.0.
  **Mitigation:** Give **profile/resource packs** semantic versions and allow pinning (e.g., `org/profile-pack@1.3`). v0.2.0-what-and-why
- **Environment isolation** still open.
  **Mitigation:** confine to **module sandboxes** / app‑layer runners (virtual envs/containers) later; kernel untouched. v0.2.0-what-and-why

---

## Bottom line

- **Carry forward:** bring‑to‑project packaging; a renamed **Profile** concept; unified config + env overrides; overlay customization; Git‑fetched resource/profile packs; CLI‑first UX; hook‑driven observability to a unified JSONL sink. v0.2.0-what-and-why Amplifier Logging & Observabili…
- **Adapt how:** **Profiles → Mount Plans** (no symlinks; no kernel policy).
- **Skip:** Claude‑specific wiring and any kernel‑side defaults/config I/O.

If you want, I can translate one of the old v0.2.0 “modes” into a **Profile** example targeting our current module IDs and produce the equivalent Mount Plan so the team has a concrete template to copy.
